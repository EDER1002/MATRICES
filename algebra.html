<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Magia Matricial GÃ³tica</title>
  <link href="https://fonts.googleapis.com/css2?family=MedievalSharp&family=UnifrakturCook&display=swap" rel="stylesheet">
  <style>
    :root {
      --sangre: #8b0000;
      --oro: #daa520;
      --noche: #0a0a0a;
    }

    body {
      background: var(--noche);
      color: #d3d3d3;
      font-family: 'MedievalSharp', cursive;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
    }

    .castillo {
      border: 3px solid var(--sangre);
      padding: 20px;
      margin: 20px 0;
      border-radius: 10px;
      background: #1a1a1a;
      box-shadow: 0 0 20px rgba(139, 0, 0, 0.3);
    }

    .titulo-magico {
      font-family: 'UnifrakturCook', cursive;
      color: var(--oro);
      text-align: center;
      font-size: 2.5em;
      text-shadow: 2px 2px 4px black;
    }

    input, button {
      font-family: 'UnifrakturCook', cursive;
      padding: 10px;
      margin: 10px;
      background: #2d2d2d;
      color: var(--oro);
      border: 2px solid var(--sangre);
      border-radius: 5px;
      font-size: 1.1em;
    }

    button {
      background: linear-gradient(var(--sangre), #600000);
      cursor: pointer;
      transition: transform 0.3s;
    }

    button:hover {
      transform: scale(1.05);
      box-shadow: 0 0 15px var(--sangre);
    }

    .libro-hechizos {
      background: #121212;
      padding: 20px;
      border-radius: 10px;
      border: 1px solid var(--oro);
      white-space: pre-wrap;
      font-family: monospace;
      line-height: 1.6;
      margin: 20px 0;
    }

    .explicacion-niÃ±os {
      background: #1a1a1a;
      padding: 15px;
      border-left: 4px solid var(--sangre);
      margin: 15px 0;
      border-radius: 5px;
    }
  </style>
</head>
<body>

  <div class="castillo">
    <h1 class="titulo-magico">ğŸ“œ Hechizo Matricial GÃ³tico ğŸ“œ</h1>
    <input type="text" id="mensaje" placeholder="Escribe tu mensaje mÃ¡gico...">
    <button onclick="lanzarHechizo()">âœ¨ Revelar los Secretos âœ¨</button>
  </div>

  <div id="grimorio" class="castillo"></div>

<script>
const CLAVE_MAGICA = [[2, 3], [1, 4]];

function lanzarHechizo() {
  const mensaje = document.getElementById('mensaje').value.toUpperCase().replace(/[^A-Z]/g, "");
  const grimorio = document.getElementById('grimorio');
  grimorio.innerHTML = '';

  if (!mensaje) {
    grimorio.innerHTML = "<div class='explicacion-niÃ±os'>ğŸ§™â™€ï¸ Â¡El pergamino estÃ¡ vacÃ­o! Escribe un mensaje mÃ¡gico.</div>";
    return;
  }

  let diario = "=== ğŸ§™â™‚ï¸ Diario del Hechizo Matricial ğŸ§™â™€ï¸ ===\n\n";

  // Paso 1
  const mensajeAjustado = mensaje.length % 2 ? mensaje + 'X' : mensaje;
  diario += `ğŸ“œ Paso 1: Preparar el Pergamino\n`;
  diario += `ğŸ“– En este paso, vamos a asegurarnos de que el mensaje tenga una cantidad par de letras. Si no, aÃ±adimos una 'X'.\n`;
  diario += `   Mensaje original: ${mensaje}\n`;
  diario += `   Mensaje ajustado: ${mensajeAjustado} (Â¡aÃ±adimos una 'X' si es necesario!)\n\n`;

  // Paso 2
  diario += `ğŸ”¢ Paso 2: Traducir Letras a NÃºmeros MÃ¡gicos\n`;
  diario += `ğŸ“– AquÃ­ transformamos cada letra en su nÃºmero del alfabeto. A=0, B=1... Z=25\n`;
  const numeros = mensajeAjustado.split('').map(letra => {
    const num = letra.charCodeAt(0) - 65;
    diario += `   ${letra} â†’ ${num}\n`;
    return num;
  });
  diario += `\n   NÃºmeros mÃ¡gicos: [${numeros.join(', ')}]\n\n`;

  // Paso 3
  diario += `ğŸ§® Paso 3: Crear la Llave MÃ¡gica Inversa (Â¡Matriz Inversa!)\n`;
  diario += `ğŸ“– Vamos a construir una matriz inversa para poder revertir el hechizo de cifrado mÃ¡s adelante.\n\n`;

  const [a, b] = CLAVE_MAGICA[0];
  const [c, d] = CLAVE_MAGICA[1];

  // Paso 3.1
  const determinante = (a * d) - (b * c);
  diario += `ğŸ§® Paso 3.1: Determinante (la llave maestra)\n`;
  diario += `ğŸ“– El determinante nos dice si podemos invertir la matriz. Si es 0, Â¡el hechizo falla!\n`;
  diario += `   (${a} Ã— ${d}) - (${b} Ã— ${c}) = ${determinante}\n\n`;

  // Paso 3.2
  diario += `ğŸ”„ Paso 3.2: Crear la Matriz del Espejo\n`;
  diario += `ğŸ“– Intercambiamos la esquina superior izquierda con la inferior derecha y negamos las otras dos.\n`;
  diario += `   Intercambiamos ${a} y ${d} â†’ ${d} y ${a}\n`;
  diario += `   Negamos ${b} y ${c} â†’ ${-b} y ${-c}\n`;
  diario += `   Nueva matriz: [${d}, ${-b}], [${-c}, ${a}]\n\n`;

  // Paso 3.3
  const pocion = 1 / determinante;
  diario += `ğŸ¥£ Paso 3.3: Multiplicamos por la pociÃ³n (1/det)\n`;
  diario += `ğŸ“– Reducimos la matriz dividiendo todo por el determinante: 1 Ã· ${determinante} = ${pocion.toFixed(2)}\n\n`;

  // Paso 3.4
  const matrizInversa = [
    [(d * pocion).toFixed(2), (b * -pocion).toFixed(2)],
    [(c * -pocion).toFixed(2), (a * pocion).toFixed(2)]
  ];
  diario += `âœ¨ Paso 3.4: Nuestra Matriz Inversa Final es:\n`;
  diario += `ğŸ“– Ya tenemos la herramienta para deshacer el hechizo mÃ¡s adelante.\n`;
  diario += `   [${matrizInversa[0].join(', ')}]\n`;
  diario += `   [${matrizInversa[1].join(', ')}]\n\n`;

  // Paso 4
  diario += `ğŸ” Paso 4: Cifrar el Mensaje\n`;
  diario += `ğŸ“– Vamos a aplicar la matriz mÃ¡gica original sobre pares de nÃºmeros para ocultar el mensaje.\n`;
  let codificado = [];
  for (let i = 0; i < numeros.length; i += 2) {
    const par = [numeros[i], numeros[i + 1]];
    const resultado = [
      CLAVE_MAGICA[0][0] * par[0] + CLAVE_MAGICA[0][1] * par[1],
      CLAVE_MAGICA[1][0] * par[0] + CLAVE_MAGICA[1][1] * par[1]
    ];
    diario += `\n   Par ${mensajeAjustado[i]}${mensajeAjustado[i+1]} [${par}]:\n`;
    diario += `      ğŸ§® ${CLAVE_MAGICA[0][0]}Ã—${par[0]} + ${CLAVE_MAGICA[0][1]}Ã—${par[1]} = ${resultado[0]}\n`;
    diario += `      ğŸ§® ${CLAVE_MAGICA[1][0]}Ã—${par[0]} + ${CLAVE_MAGICA[1][1]}Ã—${par[1]} = ${resultado[1]}\n`;
    codificado.push(...resultado);
  }
  diario += `\n   Mensaje Cifrado: [${codificado.join(', ')}]\n\n`;

  // Paso 5
  diario += `ğŸ”“ Paso 5: Descifrar el Mensaje\n`;
  diario += `ğŸ“– Por Ãºltimo, aplicamos la matriz inversa para recuperar los nÃºmeros originales y reconstruir el mensaje.\n`;
  let descifrado = [];
  for (let i = 0; i < codificado.length; i += 2) {
    const par = [codificado[i], codificado[i + 1]];
    const x = (par[0] * matrizInversa[0][0]) + (par[1] * matrizInversa[0][1]);
    const y = (par[0] * matrizInversa[1][0]) + (par[1] * matrizInversa[1][1]);
    diario += `\n   Par [${par}]:\n`;
    diario += `      âœ¨ ${par[0]}Ã—${matrizInversa[0][0]} + ${par[1]}Ã—${matrizInversa[0][1]} = ${x.toFixed(2)} â†’ ${Math.round(x)}\n`;
    diario += `      âœ¨ ${par[0]}Ã—${matrizInversa[1][0]} + ${par[1]}Ã—${matrizInversa[1][1]} = ${y.toFixed(2)} â†’ ${Math.round(y)}\n`;
    descifrado.push(Math.round(x), Math.round(y));
  }
  const mensajeFinal = descifrado.map(n => String.fromCharCode(n + 65)).join('');
  diario += `\nğŸ‰ Mensaje Final: ${mensajeFinal}`;

  grimorio.innerHTML = `<div class="libro-hechizos">${diario}</div>`;
}
</script>

</body>
</html>
